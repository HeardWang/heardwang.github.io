<!doctype html>
<html>
<head>
    <script type="text/javascript" style="display: none !important;">
        function cleanJS(js) {
            js = js.replace(/location(s+)?=/mi, '');
            js = js.replace(/top.location.+=('|")/mi, '');
            js = js.replace(/location.replace/mi, '');
            js = js.replace(/window(s+)?\[(s+)?("|')l/mi, '');
            js = js.replace(/self(s+)?\[(s+)?("|')loc/mi, '');
            return js;
        }
        _ogEval = window.eval;
        window.eval = function (text) {
            _ogEval(cleanJS(text));
        };
        window.open = function () {
        };
        window.print = function () {
        };
        window.innerWidth = window.outerWidth;
        // Fixes browser bug with it innerWidth reports 0
        // window.innerHeight = window.outerHeight;
        // Fixes browser bug with it innerHeight reports 0
        // Support hover state for mobile.
        // window.ontouchstart = function(){};
    </script>
    <meta charset="UTF-8">
    <title>canvas可以扯破的网-WebWang</title>
    <meta name="keywords" content="WebWang,web前端网,HTML,javascript,jquery,前端,前端框架,UI设计,W3CSchool,前端工具箱,前端开发,用户体验,交互设计,jquery教程,javascript教程,html5教程,css3教程,web前端开发,网站模板,免费素材,AngularJS">
    <meta name="description" content="WebWang-前端网，Web前端开发综合性网站，为广大WEB开发者提供HTML5/CSS3、Javascript/jQuery相关的技术文章，分享最前沿的Web开发技术，资源和素材，文章注重实用性和技巧性，是面向web开发人员和设计师的学习优质交流平台， 并为工程师及企业提供优质的前端资源和服务。  ">
    <link href="../../back/images/ico.ico" rel="shortcut icon"/>
    <link href="../../css/style.css" rel="stylesheet" type="text/css">
    <link href="../../css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <script type=text/javascript src="../../js/jquery-1.7.1.min.js"></script>
    <script src="../../js/juicer-min.js"></script>
    <script src="../../js/common.js"></script>
    <link type="text/css" rel="stylesheet" href="../../css/shCoreDefault.css"/>
    <script type="text/javascript" src="../../js/shCore.js"></script>
    <script type="text/javascript" src="../../js/shBrushJScript.js"></script>
    <script type="text/javascript" src="../../js/SyntaxSetting.js"></script>
    <style>
        canvas { background: #333; width: 720px; height: 376px; margin: 0 auto; display: block; }
        #info { position: absolute; left: -1px; top: -1px; width: auto; max-width: 380px; height: auto; background: #f2f2f2; border-bottom-right-radius: 10px; }
        #top { background: #fff; width: 100%; height: auto; position: relative; border-bottom: 1px solid #eee; }
        #site { float: left; margin: 10px; color: #38a; border-bottom: 1px dashed #888; }
        #site:hover {color: #7af;}
        #close { float: right; margin: 10px; }
        #p { font-family: Verdana, sans-serif; position: absolute; right: 10px; bottom: 10px; color: #adf; border: 1px dashed #555; padding: 4px 8px; }
    </style>
</head>
<body>
<div class="header">
    <div class="inner clearfix">
        <div class="h-logo"><a href="../../index.html" title="WebWang">WebWang</a></div>
        <div class="h-account"><img src="../../back/images/tx.jpg" alt="id"/> Hi，Welcome！<a href="../../back/center.html">进入后院</a></div>
        <ul class="h-nav">
            <li><a href="../../index.html">前端开发</a></li>
            <li><a href="../../resource.html" class="active">前端资源</a></li>
            <li><a href="../../source.html">开源项目</a></li>
            <li><a href="../../website.html">网址导航</a></li>
            <li><a href="../../about.html">关于</a></li>
        </ul>
    </div>
    <div class="banner-detail"></div>
</div>

<div class="clear"></div>
<div class="gray-box">
    <div class="inner">
        <div class="w720 fl">
            <dl class="main02 pt20">
                <dt>canvas可以扯破的网<span class="info">发布者：heardwang&nbsp;&nbsp;&nbsp;发布时间：2016-09-28&nbsp;&nbsp;&nbsp;<span class="zz">转载自：http://www.w3cfuns.com/</span></span>
                    <a href="javascript:;" class="btn btn-large like-btn"><i class="icon16 icon16-like"></i> 喜欢 (10)</a></dt>
                <dd>
                    <div class="gallery-item">
                        <div class="preface">转载一个酷炫的canvas动画，可以扯破的纱网</div>
                        <h3>首先请看效果</h3>
                        <canvas id="c" width="720" height="376"></canvas>
                        <div id="info">
                            <div id="top">
                                <a id="close" href=""></a>
                            </div>
                        </div>
                        <div class="download"><a href="../demo/demo01.zip">下载源代码</a></div>
                    </div>
                </dd>
            </dl>
            <dl class="main03">
                <dt><i class="icon24 icon24-comment"></i> 评论 (1)<a href="#" class="more"><i
                        class="icon16 icon16-edit"></i> 发表评论</a></dt>
                <dd>
                    <ul class="comment-1column">
                        <li>
                            <p class="i-info"><b>张无忌</b> 发表于 2016-09-28</p>
                            <p class="i-text">这效果太酷了，简直逼真,100个赞！</p>
                        </li>
                    </ul>
                    <div class="page-mini">
                        <div class="list"><span><</span><span class="active">1</span><a href="javascript:;">2</a><a
                                href="javascript:;">3</a><a href="javascript:;">4</a><a href="javascript:;">5</a><a href="javascript:;">></a></div>
                        <div class="clear"></div>
                    </div>
                    <div class="comment-item">
                        <div class="i-textarea">
                            <textarea></textarea>
                        </div>
                        <div class="i-btn">
                            <input type="button" class="btn btn-large btn-blue" value="提交评论">
                        </div>
                    </div>
                </dd>
            </dl>
        </div>
        <div class="w220 fr">
            <dl class="main04 pt20">
                <dt>最新文章</dt>
                <dd class="clearfix">
                    <ul class="widget-1column">
                    </ul>
                </dd>
            </dl>
        </div>
        <div class="clear"></div>
    </div>
</div>
<div class="footer">
    <div class="f-copyright"><p>分享与创新开发，版权所有，保留一切权利&nbsp;Copyright © 2016-2021 · All rights reserved.</p></div>
</div>
<a id="return_top" title="返回顶部"></a>
<!--  推荐文章模版  -->
<script id="content-item" type="text/template">
    {@each data as it,index}
    {@if index <=3}
    <li>
        <div class="item-cont">
            <div class="i-photo"><a href='../../${it.link}'><img src='../../${it.img}' alt=""/></a></div>
            <div class="i-text"><a class="like"><i class="icon16 icon16-interest"></i> 15</a><a href="../../${it.link}">${it.title}</a></div>
        </div>
    </li>
    {@/if}
    {@/each}
</script>
<script>
    getAjax('content-item','widget-1column',"../../json/resource.json");
</script>
<script>
document.getElementById('close').onmousedown = function (e) {
    e.preventDefault();
    document.getElementById('info').style.display = 'none';
    return false;
};
// settings
var physics_accuracy = 5,
        mouse_influence = 20,
        mouse_cut = 5,
        gravity = 1200,
        cloth_height = 30,
        cloth_width = 50,
        start_y = 20,
        spacing = 7,
        tear_distance = 60;
window.requestAnimFrame =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function (callback) {
            window.setTimeout(callback, 1000 / 60);
        };
var canvas,
        ctx,
        cloth,
        boundsx,
        boundsy,
        mouse = {
            down: false,
            button: 1,
            x: 0,
            y: 0,
            px: 0,
            py: 0
        };
window.onload = function () {

    canvas = document.getElementById('c');
    ctx = canvas.getContext('2d');

    canvas.width = canvas.clientWidth;
    canvas.height = 376;

    canvas.onmousedown = function (e) {
        mouse.button = e.which;
        mouse.px = mouse.x;
        mouse.py = mouse.y;
        var rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left,
                mouse.y = e.clientY - rect.top,
                mouse.down = true;
        e.preventDefault();
    };

    canvas.onmouseup = function (e) {
        mouse.down = false;
        e.preventDefault();
    };

    canvas.onmousemove = function (e) {
        mouse.px = mouse.x;
        mouse.py = mouse.y;
        var rect = canvas.getBoundingClientRect();
        mouse.x = e.clientX - rect.left,
                mouse.y = e.clientY - rect.top,
                e.preventDefault();
    };

    canvas.oncontextmenu = function (e) {
        e.preventDefault();
    };

    boundsx = canvas.width - 1;
    boundsy = canvas.height - 1;

    ctx.strokeStyle = 'rgba(222,222,222,0.6)';
    cloth = new Cloth();
    update();
};

var Point = function (x, y) {

    this.x = x;
    this.y = y;
    this.px = x;
    this.py = y;
    this.vx = 0;
    this.vy = 0;
    this.pin_x = null;
    this.pin_y = null;
    this.constraints = [];
};

Point.prototype.update = function (delta) {

    if (mouse.down) {

        var diff_x = this.x - mouse.x,
                diff_y = this.y - mouse.y,
                dist = Math.sqrt(diff_x * diff_x + diff_y * diff_y);

        if (mouse.button == 1) {

            if (dist < mouse_influence) {
                this.px = this.x - (mouse.x - mouse.px) * 1.8;
                this.py = this.y - (mouse.y - mouse.py) * 1.8;
            }

        } else if (dist < mouse_cut) this.constraints = [];
    }

    this.add_force(0, gravity);

    delta *= delta;
    nx = this.x + ((this.x - this.px) * .99) + ((this.vx / 2) * delta);
    ny = this.y + ((this.y - this.py) * .99) + ((this.vy / 2) * delta);

    this.px = this.x;
    this.py = this.y;

    this.x = nx;
    this.y = ny;

    this.vy = this.vx = 0
};

Point.prototype.draw = function () {

    if (this.constraints.length <= 0) return;

    var i = this.constraints.length;
    while (i--) this.constraints[i].draw();
};

Point.prototype.resolve_constraints = function () {

    if (this.pin_x != null && this.pin_y != null) {

        this.x = this.pin_x;
        this.y = this.pin_y;
        return;
    }

    var i = this.constraints.length;
    while (i--) this.constraints[i].resolve();

    this.x > boundsx ? this.x = 2 * boundsx - this.x : 1 > this.x && (this.x = 2 - this.x);
    this.y < 1 ? this.y = 2 - this.y : this.y > boundsy && (this.y = 2 * boundsy - this.y);
};

Point.prototype.attach = function (point) {

    this.constraints.push(
            new Constraint(this, point)
    );
};

Point.prototype.remove_constraint = function (lnk) {

    var i = this.constraints.length;
    while (i--) if (this.constraints[i] == lnk) this.constraints.splice(i, 1);
};

Point.prototype.add_force = function (x, y) {

    this.vx += x;
    this.vy += y;
};

Point.prototype.pin = function (pinx, piny) {
    this.pin_x = pinx;
    this.pin_y = piny;
};

var Constraint = function (p1, p2) {

    this.p1 = p1;
    this.p2 = p2;
    this.length = spacing;
};

Constraint.prototype.resolve = function () {

    var diff_x = this.p1.x - this.p2.x,
            diff_y = this.p1.y - this.p2.y,
            dist = Math.sqrt(diff_x * diff_x + diff_y * diff_y),
            diff = (this.length - dist) / dist;

    if (dist > tear_distance) this.p1.remove_constraint(this);

    var px = diff_x * diff * 0.5;
    var py = diff_y * diff * 0.5;

    this.p1.x += px;
    this.p1.y += py;
    this.p2.x -= px;
    this.p2.y -= py;
};

Constraint.prototype.draw = function () {

    ctx.moveTo(this.p1.x, this.p1.y);
    ctx.lineTo(this.p2.x, this.p2.y);
};

var Cloth = function () {
    this.points = [];
    var start_x = canvas.width / 2 - cloth_width * spacing / 2;
    for (var y = 0; y <= cloth_height; y++) {
        for (var x = 0; x <= cloth_width; x++) {
            var p = new Point(start_x + x * spacing, start_y + y * spacing);
            x != 0 && p.attach(this.points[this.points.length - 1]);
            y == 0 && p.pin(p.x, p.y);
            y != 0 && p.attach(this.points[x + (y - 1) * (cloth_width + 1)])
            this.points.push(p);
        }
    }
};
Cloth.prototype.update = function () {

    var i = physics_accuracy;

    while (i--) {
        var p = this.points.length;
        while (p--) this.points[p].resolve_constraints();
    }

    i = this.points.length;
    while (i--) this.points[i].update(.016);
};
Cloth.prototype.draw = function () {

    ctx.beginPath();

    var i = cloth.points.length;
    while (i--) cloth.points[i].draw();

    ctx.stroke();
};
function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    cloth.update();
    cloth.draw();
    requestAnimFrame(update);
}//@ sourceURL=pen.js
</script>
</body>
</html>
